#!/usr/bin/env node

/**
 * Fix locale routing for GitHub Pages
 *
 * This script creates index.html files in locale folders that redirect
 * to the proper .html files generated by Next.js static export.
 *
 * Run after: npm run build
 */

const fs = require('fs');
const path = require('path');

const OUT_DIR = path.join(__dirname, '..', 'out');
const LOCALES = ['en', 'fr'];
const BASE_PATH = '/opulanzbanking';

console.log('üîß Fixing locale routes for GitHub Pages...\n');

LOCALES.forEach(locale => {
  const localeDir = path.join(OUT_DIR, locale);
  const indexPath = path.join(localeDir, 'index.html');
  const targetFile = `${locale}.html`;

  // Check if locale directory exists
  if (!fs.existsSync(localeDir)) {
    console.log(`‚ö†Ô∏è  Directory ${locale}/ not found, skipping...`);
    return;
  }

  // Create index.html that redirects to the locale homepage
  const html = `<!DOCTYPE html>
<html lang="${locale}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting...</title>
    <meta http-equiv="refresh" content="0; url=${BASE_PATH}/${targetFile}">
    <link rel="canonical" href="https://tajking10.github.io${BASE_PATH}/${targetFile}">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            margin: 0;
            background: linear-gradient(135deg, #252623 0%, #3a3d37 100%);
            color: white;
            text-align: center;
            padding: 2rem;
        }
        .container {
            max-width: 500px;
        }
        h1 {
            color: #b59354;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }
        .spinner {
            border: 3px solid rgba(181, 147, 84, 0.3);
            border-top: 3px solid #b59354;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 2rem auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        a {
            color: #b59354;
            text-decoration: none;
            font-weight: 600;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
    <script>
        // Redirect to the proper locale homepage
        window.location.href = '${BASE_PATH}/${targetFile}';
    </script>
</head>
<body>
    <div class="container">
        <h1>Opulanz Banking</h1>
        <div class="spinner"></div>
        <p>Redirecting to ${locale === 'fr' ? 'French' : 'English'} homepage...</p>
        <p>If not redirected, <a href="${BASE_PATH}/${targetFile}">click here</a>.</p>
    </div>
</body>
</html>`;

  fs.writeFileSync(indexPath, html, 'utf8');
  console.log(`‚úÖ Created ${locale}/index.html ‚Üí redirects to ${targetFile}`);
});

console.log('\n‚ú® Locale routing fixed successfully!\n');
